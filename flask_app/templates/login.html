{% extends 'shared/layout.html' %}

{% block extrajs %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
{% endblock %}

{% block maincontent %}
<br><br>
<form id="loginForm">
    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required>
    <br>
    <label for="password">Password:</label>
    <input type="password" id="password" name="password" required>
    <br>
    <div class="buttons-container">
        <button type="submit">Login</button>
        <button type="submit">New User</button>
    </div>
    
</form>
<div id="error-message"></div>
<br><br>
<!-- <input type="none" value=" Login as Owner" onclick="checkCredentials()" /> -->

<script>
let count = 0;
function checkCredentials() {
    // package data in a JSON object
    var data_d = {'email': 'owner@email.com', 'password': 'password'};
    console.log('data_d', data_d);

    // SEND DATA TO SERVER VIA jQuery.ajax({})
    jQuery.ajax({
        url: "/processlogin",
        data: data_d,
        type: "POST",
        success: function(returned_data) {
            returned_data = JSON.parse(returned_data);
            window.location.href = "/home";
        }
    });
}

$(document).ready(function() {
    $('#loginForm').on('submit', function(event) {
        event.preventDefault();
        var data_d = {
            'email': $('#email').val(),
            'password': $('#password').val()
        };
        $.ajax({
            url: "/processlogin",
            data: data_d,
            type: "POST",
            success: function(returned_data) {
                returned_data = JSON.parse(returned_data);
                if (returned_data.success) {
                    window.location.href = "/home";
                } else {
                    count++;
                    $('#error-message').text('Authentication Failure: ' + count);
                }
            }
        });
    });
});
</script>
{% endblock %}
